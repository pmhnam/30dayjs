<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <title>Document</title>
</head>

<body>
    <h1></h1>
    <form action="" method="dialog" name='form1' onsubmit="addplayer()">
        <input id='firstname' name='firstname' type="text" required>
        <input id='lastname' name='lastname' type="text" required>
        <input id='country' name='country' type="text" required>
        <input id='score' name='score' type="number" required>
        <input id='add' type="submit" value="add player">
    </form>
    <p class="noted"></p>
    <div class="container">

    </div>

    <script>
        var cnt = document.querySelector('.container')
        var noted = document.querySelector('.noted')
        var date = new Date()
        
        var number = localStorage.getItem('number')
        number === null ? number = 1 : number = localStorage.getItem('number')
        console.log('number',number);

        const plusScore = (e) => {
            let ele = e.target.previousElementSibling.previousElementSibling
            clName = e.target.parentNode.className
            let sc = ele.textContent
            ele.textContent = parseInt(sc) + 5
            // chỉnh sửa data
            let dataText = sessionStorage.getItem(clName)
            let data = JSON.parse(dataText)
            data['score'] = ele.textContent
            dataJson = JSON.stringify(data, undefined, 4)
            sessionStorage.setItem(clName, dataJson)
        }
        
        const minusScore = (e) => {
            let ele = e.target.previousElementSibling.previousElementSibling.previousElementSibling
            clName = e.target.parentNode.className
            let sc = ele.textContent
            ele.textContent = parseInt(sc) - 5
            // chỉnh sửa data
            let dataText = sessionStorage.getItem(clName)
            let data = JSON.parse(dataText)
            data['score'] = ele.textContent
            dataJson = JSON.stringify(data, undefined, 4)
            sessionStorage.setItem(clName, dataJson)
            // console.log(sessionStorage.getItem(clName));
        }

        const removePlayer = (e) => {
            let clName = e.target.parentNode.parentNode.className
            let element = document.querySelector(`.${clName}`)
            sessionStorage.removeItem(clName)
            cnt.removeChild(element)
        }

        const addplayer = () => {
            let div = document.createElement('div')
            let clName = 'player_' + number
            console.log(clName);
            div.className = clName
            cnt.appendChild(div)
            let fullName = document.createElement('p')
            let time = document.createElement('p')
            let country = document.createElement('p')
            let score = document.createElement('p')
            let remove = document.createElement('button')
            let cong = document.createElement('button')
            let tru = document.createElement('button')
            div.appendChild(fullName)
            div.appendChild(time)
            div.appendChild(country)
            div.appendChild(score)
            div.appendChild(remove)
            div.appendChild(cong)
            div.appendChild(tru)

            fullName.textContent = document.forms['form1']['firstname'].value + ' ' + document.forms['form1']['lastname'].value
            time.textContent = date.toLocaleString()
            country.textContent = document.forms['form1']['country'].value
            score.textContent = document.forms['form1']['score'].value
            remove.innerHTML = `<i class="fa fa-trash" aria-hidden="true"></i>`
            remove.style.padding = "0px"
            remove.style.borderRadius = "20px"
            remove.setAttribute('onclick', 'removePlayer(event)')
            cong.textContent = '+5'
            cong.setAttribute('onclick', 'plusScore(event)')
            tru.textContent = '-5'
            tru.setAttribute('onclick', 'minusScore(event)')
            let dataList = {
                "fullName": fullName.textContent,
                "time": time.textContent,
                "country": country.textContent,
                "score": score.textContent
            }
            let dataText = JSON.stringify(dataList, undefined, 4)
            let data = sessionStorage.setItem(clName,dataText)
            number++
            localStorage.setItem('number',number)
        }

        
        const printData = () => {
            let obj = Object.keys(sessionStorage).reduce(function(obj, key) {
                
                let div = document.createElement('div')
                let clName = key
                div.className = clName
                cnt.appendChild(div)
                let fullName = document.createElement('p')
                let time = document.createElement('p')
                let country = document.createElement('p')
                let score = document.createElement('p')
                let remove = document.createElement('button')
                let cong = document.createElement('button')
                let tru = document.createElement('button')
                div.appendChild(fullName)
                div.appendChild(time)
                div.appendChild(country)
                div.appendChild(score)
                div.appendChild(remove)
                div.appendChild(cong)
                div.appendChild(tru)

                let dataText = sessionStorage.getItem(key)
                console.log('dataText',dataText);
                let data = JSON.parse(dataText)
                console.log(`${clName}`,data);
                fullName.textContent = data['fullName']
                time.textContent = data['time']
                country.textContent = data['country']
                score.textContent = data['score']
                remove.innerHTML = `<i style="padding:5px 7px; margin:0px" class="fa fa-trash" aria-hidden="true"></i>`
                remove.style.padding = "0px"
                remove.style.borderRadius = "20px"
                remove.setAttribute('onclick', 'removePlayer(event)')
                cong.textContent = '+5'
                cong.setAttribute('onclick', 'plusScore(event)')
                tru.textContent = '-5'
                tru.setAttribute('onclick', 'minusScore(event)')

            }, {});

        }
        printData()
        console.log(sessionStorage);
        // console.log(localStorage.clear());
    </script>
</body>